<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <title>BUI示例</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/buijs/lib/latest/bui.css">
    <script src="https://cdn.jsdelivr.net/npm/buijs/lib/zepto.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/buijs/lib/latest/bui.js"></script>
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
    <style></style>
</head>
<body>

<div class="bui-page">
    <header class="bui-bar">
        <div class="bui-bar-left">
            <a class="bui-btn" onclick="bui.back();"><i class="icon-back"></i></a>
        </div>
        <div class="bui-bar-main">搜索加载</div>
        <div class="bui-bar-right">
        </div>
    </header>
    <main>
        <!-- 搜索条控件结构 -->
        <div id="searchbar" class="bui-searchbar bui-box">
            <div class="span1">
                <div class="bui-input">
                    <i class="icon-search"></i>
                    <input type="search" value="" placeholder="请输入关键字"/>
                </div>
            </div>
            <div class="btn-search">搜索</div>
        </div>
        <!-- 列表控件结构 -->
        <div id="scrollSearch" class="bui-scroll">
            <div class="bui-scroll-head"></div>
            <div class="bui-scroll-main">
                <ul class="bui-list">

                </ul>
            </div>
            <div class="bui-scroll-foot"></div>
        </div>

    </main>
</div>

<script>/**
 * 搜索列表页模板
 * 默认模块名: pages/searchbar/searchbar
 * @return {[object]}  [ 返回一个对象 ]
 */
bui.ready(function(){
    var pageview = {};

    function getInfo() {
        $.getJSON('/user/getuserinfo',function (data) {
            if (data.success){
                var html = '';
                users = $.parseJSON(data.user);
                console.log(users)
                $.map(users,function () {
                    html +=`<li class="bui-btn bui-box">
                         <div class="span1">
                             <h3 class="item-title">${users.username}</h3>
                             <p class="item-text">${users.phoneNumber}</p>
                             <p class="item-text">${users.dormAddr}</p>
                         </div>
                     </li>`
                })
                $('.bui-list').html(html);
            }
        })

    }
    function getlist() {
        $.ajax({
            url : "/user/getuserinfo",
            type : "get",
            success : function(data) {
                if (data.success) {
                    var html = '';
                    var users = data.user;
                    data.map(function (user, index) {
                        html +=`<li class="bui-btn bui-box">
                         <div class="span1">
                             <h3 class="item-title">${user.username}</h3>
                             <p class="item-text">${user.phoneNumber}</p>
                             <p class="item-text">${user.dormAddr}</p>
                         </div>
                     </li>`
                    });
                    $('.bui-list').html(html);
                }
            }
        });
    }

    // 模块初始化定义
    pageview.init = function () {
        getInfo();
        // var n = 0;
        //搜索条的初始化
        var uiSearchbar = bui.searchbar({
            id:"#searchbar",
            onInput: function(e,keyword) {
                //实时搜索
                // console.log(++n)
            },
            onRemove: function(e,keyword) {
                //删除关键词需要做什么其它处理
                // console.log(keyword);
            },
            callback: function (e,keyword) {

                if( uiList ){

                    //点击搜索清空数据
                    uiList.empty();
                    // 重新初始化数据
                    uiList.init({
                        page: 1,
                        data: {
                            "keyword":keyword
                        }
                    });
                }
            }
        });
    }

    // 执行初始化
    pageview.init();

})

</script>
</body>
</html>